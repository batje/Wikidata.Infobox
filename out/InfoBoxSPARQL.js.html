<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: InfoBoxSPARQL.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: InfoBoxSPARQL.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Copyright (c) 2016, Reinier Battenberg
 * All rights reserved.
 *
 * Source code can be found at:
 * https://github.com/batje/Wikidata.Infobox
 *
 * @license ISC
 */
"use strict"
import HandleBarsWrapper from './HandleBarsWrapper/HandleBarsWrapper.js';
/** InfoBox Class */
class InfoBoxSPARQL {

  constructor() {
    var me = this;
    this.handlebars = HandleBarsWrapper.HandleBarsWrapper();;
  }

  getentities(Q, languages) {
    var simplifiedClaims, labels, entity;

    //  var url = wdk.getEntities(ids, languages, properties, format)
    var url = wdk.getEntities(Q, languages);
    // This is an official example from the examples on query.wikidata.org
    // The problem with this one and the next is that only attributes that refer to another
    // wikidata item are included, but no hard values like date of birth and official website
    // 
    url = wdk.sparqlQuery(
      `#Data of Douglas Adams
PREFIX entity: &lt;http://www.wikidata.org/entity/>
#partial results

SELECT ?propUrl ?propLabel ?valUrl ?valLabel ?picture
WHERE
{
	hint:Query hint:optimizer 'None' .
	{	BIND(entity:Q42 AS ?valUrl) .
		BIND("N/A" AS ?propUrl ) .
		BIND("identity"@en AS ?propLabel ) .
	}
	UNION
	{	entity:Q42 ?propUrl ?valUrl .
		?property ?ref ?propUrl .
		?property a wikibase:Property .
		?property rdfs:label ?propLabel
	}

  	?valUrl rdfs:label ?valLabel
	FILTER (LANG(?valLabel) = 'en') .
	OPTIONAL{ ?valUrl wdt:P18 ?picture .}
	FILTER (lang(?propLabel) = 'en' )
}
ORDER BY ?propUrl ?valUrl
LIMIT 200`
    );

    url = wdk.sparqlQuery(
      `PREFIX entity: &lt;http://www.wikidata.org/entity/>
      SELECT ?predicate ?predicateLabel ?object ?objectLabel ?relationship
      WHERE {
        entity:${Q} ?predicate ?object.
        ?property wikibase:directClaim ?predicate.
        ?property rdfs:label ?relationship.
        SERVICE wikibase:label {
          bd:serviceParam wikibase:language "nl,en".
        }
        ?object rdfs:label ?objectLabel.
        FILTER((LANG( ?objectLabel)) = "en")
        FILTER((LANG( ?relationship)) = "en")
      }
    LIMIT 100`
    );


    var me = this;
    $.ajax({
        //  dataType: "jsonp",
        url: url,
      })
      .done(function(data) {
        var results = data.results.bindings;
        var entity = data.entities[Q];
        var entities = wdk.parse.wd.entities;
        //  var entities = wdk.parse.wd.entities(data);
        var simplifiedClaims = wdk.simplifyClaims(entity.claims);
        //  alert(entities);

        //    We also want the attributes / wikidata items Q codes here!
        //        The Q values are in the simplifiedClaims as values
        var properties = Object.keys(simplifiedClaims);
        var url2 = wdk.getEntities(properties, languages);
        //alert("done");
        //request(url2 ....
        $.ajax({
            dataType: "jsonp",
            url: url2,
          })
          .done(function(labels) {

            //            _.each(labels.entities, function(label, key, labels) {
            //              entity.claims[key].label = label;
            //            });

            $('#infobox').append("&lt;h2>" + entity.labels[Object.keys(entity.labels)[0]].value + "&lt;/h2>")
            $('#infobox').append("&lt;i>" + entity.descriptions[Object.keys(entity.descriptions)[0]].value +
              "&lt;/i>")

            var object = {
              entity: entity,
              labels: labels,
              languages: languages
            }
            me.handlebars.getTemplate('infobox').then(function(infobox) {
              console.log("fetched infoboxhbs", infobox);
              infobox(object).then(function(html) {
                console.log("fetched html");
                $('#infobox').html(html);
                me.handlebars.postProcess('#infobox');
              });
            });
          })
      })

    .fail(function(err) {
      alert("error");
    });
  }
}

export {
  InfoBoxSPARQL
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Util%25252520Classes.html">Util Classes</a></li><li><a href="module-WikidataHelpers.html">WikidataHelpers</a></li></ul><h3>Classes</h3><ul><li><a href="HandleBarsWrapperClass.html">HandleBarsWrapperClass</a></li><li><a href="InfoBox.html">InfoBox</a></li><li><a href="InfoBoxSPARQL.html">InfoBoxSPARQL</a></li><li><a href="LabelFetcherClass.html">LabelFetcherClass</a></li><li><a href="module-Util%2520Classes-ImageGalleryClass.html">ImageGalleryClass</a></li><li><a href="module-Util%2520Classes-TemplateBaseClass.html">TemplateBaseClass</a></li><li><a href="module-WikidataHelpers-TimeClass.html">TimeClass</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sun Aug 21 2016 10:45:07 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
