<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utilclasses/WikiMediaImage.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utilclasses/WikiMediaImage.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Copyright (c) 2016, Reinier Battenberg
 * All rights reserved.
 *
 * Source code can be found at:
 * https://github.com/batje/Wikidata.Infobox
 *
 * @license GPL 3.0
 * @module Util Classes
 */

"use strict"
var instance;

/* @class
 * Class renders Wikimedia Images including all their metadata
 * Am still not exactly sure if and how to make this extending @class TemplateBaseClass
 * For now it is on its own.
 */
class WikiMediaImageClass {
  constructor(handlebars) {
    this.handlebars = handlebars;
    this.css = [];
  }

  /** @function render
   * @param filename Name of the Image file from Commons to render. Without preceding 'Image:' or 'File:'
   * @param template Handlebars template to use, defaults to 'Image'
   * @param gallery Optional name of gallery to add to the image html in the template
   * @returns Promise that resolves to the HTML for the image
   */
  render(filename, template = 'Image', gallery = false) {
      console.log("This Image Handlebars", this.handlebars);
      var me = this;
      //      console.log("Image Handlebars", me.handlebars);
      var image;
      return new Promise(function(resolve, reject) {
        var url =
          `https://commons.wikimedia.org/w/api.php?action=query&amp;titles=Image:${filename}&amp;prop=imageinfo&amp;iiprop=extmetadata&amp;format=json`;
        console.log("Going to load image metadata from url ", url);
        try {
          $.ajax({
              url: url,
              dataType: "jsonp"
            })
            .done(function(data) {
              console.log("loaded image", data);
              try {
                image = data.query.pages[Object.keys(data.query.pages)[0]].imageinfo[0];
                image.filename = filename;
                if (gallery) {
                  image.gallery = gallery;
                }
              } catch (e) {
                console.log("Error in array", e);
              }
              console.log("Going to fetch template", template);
              me.handlebars.getTemplate(template, false, true)
                .then(function(hbtemplate) {
                  Promise.resolve(hbtemplate(image))
                    .then(function(html) {
                      console.log("Compiled result " + html);
                      resolve(html);
                    })
                    .catch(function(e) {
                      console.error("Can not generate image html", e);
                    })
                })
                .catch(function(e) {
                  console.error("Can not find Image template");
                });
            })
            .catch(function(e) {
              error.error("error fetching metadata for image " + filename, e);
            });
        } catch (e) {
          console.log("error fetching metadata", e);
        }
      })
    }
    /*  postProcess() {
        $('.links').click(function(event) {
          event = event || window.event;
          var target = event.target || event.srcElement,
            link = target.src ? target.parentNode : target,
            options = {
              index: link,
              event: event
            },
            links = this.getElementsByTagName('a');
          blueimp.Gallery(links, options);
        });
      };*/
}

function WikiMediaImage(handlebars) {
  if (typeof instance === 'undefined') {
    instance = new WikiMediaImageClass(handlebars);
  }
  return instance;
}


export default {
  WikiMediaImage
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Util%25252520Classes.html">Util Classes</a></li><li><a href="module-WikidataHelpers.html">WikidataHelpers</a></li></ul><h3>Classes</h3><ul><li><a href="HandleBarsWrapperClass.html">HandleBarsWrapperClass</a></li><li><a href="InfoBox.html">InfoBox</a></li><li><a href="InfoBoxSPARQL.html">InfoBoxSPARQL</a></li><li><a href="LabelFetcherClass.html">LabelFetcherClass</a></li><li><a href="module-Util%2520Classes-ImageGalleryClass.html">ImageGalleryClass</a></li><li><a href="module-Util%2520Classes-TemplateBaseClass.html">TemplateBaseClass</a></li><li><a href="module-WikidataHelpers-TimeClass.html">TimeClass</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sun Aug 21 2016 10:45:07 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
